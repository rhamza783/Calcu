"use strict";function Translation(n,t){if(o(t)){loadJson(t,function(n){this.translation=a(n)})}else{this.translation=a(t)}this.defaultTags=n;this.defaultTags.push("_default");var e=this;this.get=function(n){if(!Array.isArray(n)){n=[n]}if(n.length>50){return"!!!RECUTION!!!"}return i(this.translate(r(n.concat(this.defaultTags),this.translation),n),n)};function r(n,t){if(s(t)){return t}for(var e=0;e<n.length;e++){if(t[n[e]]!==undefined){return r(n,t[n[e]])}}return""}this.translate=function(n,t){var e=n.split(/\{([a-zA-Z0-9_][^\}]*)\}/);if(t===undefined){t=[]}for(var r=1;r<e.length;r+=2){if(e[r]instanceof EString){e[r]=e[r].str}if(parseInt(e[r])==e[r]){var i=parseInt(e[r]);if(i<0){i=t.length-i}e[r]=t[i]}else if(e[r]==""){e[r]=t.join(":")}else{e[r]=this.get(e[r].replace("!",":!").split(":").concat(t))}}if(n instanceof EString){return n.join(e,"").replace("{!","{")}else{return e.join("").replace("{!","{")}};function a(n,t){if(t===undefined){t=[]}else{t=t.slice()}if(s(n)){if(!o(n)){n=""+n}var e=n.split(/([a-zA-Z0-9_]*!)/);if(e[0]===""){for(var r=1;r<e.length;r+=2){if(e[r]==="!"){e[r]="";break}else{t.push(e[r].substr(0,e[r].length-1));e[r]=""}if(e[r+1]!==""){break}}n=e.join("")}return new EString(n,t)}if(Array.isArray(n)){for(var r=1;r<n.length;r++){n[r]=a(n[r],t)}return n}for(var i in n){if(n.hasOwnProperty(i)){n[i]=a(n[i],t)}}return n}function i(n,t){var e=[];for(var r=0;r<t.length;r++){if(t[r].substr(0,1)=="!"){e.push(t[r].substr(1))}}if(!(n instanceof EString)){n=new EString(n)}return n.toString(e)}function s(n){return n instanceof String||n instanceof EString||n instanceof Number||n instanceof Boolean||n===undefined||n===null||!(n instanceof Object)}function o(n){return n instanceof String||n instanceof EString||typeof n==="string"}}Translation.detectLanguage=function(){let n=null;if(window.location.hash.includes("locale=")){n=window.location.hash.split(/locale=/)[1].split(/#/)[0]}let t=n||navigator.language||"en-GB";return t.split("-").reverse()};Translation.loadJson=function(n,t,e){var r=new XMLHttpRequest;r.overrideMimeType("application/json");r.open("GET",t,true);r.onreadystatechange=function(){if(r.readyState===4&&r.status=="200"){e(new Translation(n,JSON.parse(r.responseText)))}};r.send(null)};function EString(n,t){if(t===undefined){this.encodings=[]}else if(!Array.isArray(t)){this.encodings=[this.encodings]}else{this.encodings=t.slice()}this.str=n}EString.prototype={toString:function(n){if(n===undefined){n=[]}if(!Array.isArray(n)){n=[n]}var t=this.encodings.slice();n=n.slice();var e=this.str;while(t.length||n.length){if(t.length){var r=t.pop();if(n[0]==r){n.shift()}else{e=a(e,r)}}else{e=i(e,n.shift())}}return e;function i(n,t){switch(t){case"html":return s(n);case"url":return f(n);default:return n}}function a(n,t){switch(t){case"html":return o(n);case"url":return u(n);default:return n}}function s(n){var t=document.createElement("div");t.innerText=n;return t.innerHTML.replace(/\r\n|\r|\n/,"<br/>")}function o(n){var t=document.createElement("div");t.innerHTML=n;return t.innerText}function l(n){var t=document.createElement("textarea");t.innerText=n;return t.innerHTML}function c(n){var t=document.createElement("textarea");t.innerHTML=n;return t.innerText}function f(n){return escape(n)}function u(n){return unescape(n)}function h(){}function g(){}function d(){}function p(){}function v(n,t){for(var e=0;e<n.length;e++){if(n[e]==t){return true}}return false}},split:function(n){var t=this.str.split(n);for(var e=0;e<t.length;e++){t[e]=new EString(t[e],this.encodings)}return t},join:function(n,t){for(var e=0;e<n.length;e++){if(n[e]instanceof EString){n[e]=n[e].toString(this.encodings.reverse())}}return new EString(n.join(t),this.encodings)},replace:function(n,t){return new EString(this.str.replace(n,t),this.encodings)}};Translation=wrapWithDebug(Translation);if(DEBUG){var t=new Translation(["en"],{link:'html!<a href="{page!url}">{label}</a>',page:"url!http://www.schoettler.com/calctapeweb/calctape.html?foo={param:0}&bar={param:1}",param:["x<1/2 && y>1/2","html!url!%2F&amp;baz=123"],label:"->"});var result=t.translate("{link!html}");var shouldbe='<a href="http://www.schoettler.com/calctapeweb/calctape.html?foo='+escape("x<1/2 && y>1/2")+'&amp;bar=%2F&amp;baz=123">-&gt;</a>';result===shouldbe||console.error("test failed: \n>>>"+result+"<<<\n>>>"+shouldbe+"<<<");var s;s=new EString("<br>",["html"]);s.toString(["html"])==="<br>"||console.error("test failed");s.toString()==="\n"||console.error("test failed");s=new EString("<br>");s.toString(["html"])=="&lt;br&gt;"||console.error("test failed");s.toString()=="<br>"||console.error("test failed");s=new EString("\n");s.toString(["html"])==="<br>"||console.error("test failed");s.toString()==="\n"||console.error("test failed");s=new EString("a\nb",["html"]);s.toString()=="a b"||console.error("test failed")}